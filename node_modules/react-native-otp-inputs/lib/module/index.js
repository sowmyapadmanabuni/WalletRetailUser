import _extends from"@babel/runtime/helpers/extends";import _regeneratorRuntime from"@babel/runtime/regenerator";import _slicedToArray from"@babel/runtime/helpers/slicedToArray";import _objectWithoutProperties from"@babel/runtime/helpers/objectWithoutProperties";import _defineProperty from"@babel/runtime/helpers/defineProperty";var _jsxFileName="/Users/damiansznajder/Projects/Private/otp-inputs/src/index.tsx";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(source,true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(source).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}import React,{forwardRef,useCallback,useEffect,useImperativeHandle,useReducer,useRef}from'react';import{Clipboard,Keyboard,View,Platform}from'react-native';import KeyEvent from'react-native-keyevent';import OtpInput from'./OtpInput';import{OtpInputsRef}from'./types';import{fillOtpCode}from'./helpers';var ACTION_TYPES={setOtpTextForIndex:'setOtpTextForIndex',setOtpCode:'setOtpCode',clearOtp:'clearOtp'};var BACKSPACE_KEY_CODE=67;var reducer=function reducer(state,action){switch(action.type){case ACTION_TYPES.setOtpTextForIndex:{var _otpCode=_objectSpread({},state.otpCode,_defineProperty({},""+action.payload.index,action.payload.text));state.handleChange(Object.values(_otpCode).join(''));return _objectSpread({},state,{otpCode:_otpCode});}case ACTION_TYPES.setOtpCode:{var _otpCode2=fillOtpCode(action.payload.numberOfInputs,action.payload.code);state.handleChange(Object.values(_otpCode2).join(''));return _objectSpread({},state,{otpCode:_otpCode2});}case ACTION_TYPES.clearOtp:{var _otpCode3=fillOtpCode(action.payload);state.handleChange(Object.values(_otpCode3).join(''));return _objectSpread({},state,{otpCode:_otpCode3});}default:return state;}};var OtpInputs=forwardRef(function(_ref,ref){var autoCapitalize=_ref.autoCapitalize,clearTextOnFocus=_ref.clearTextOnFocus,defaultValue=_ref.defaultValue,focusStyles=_ref.focusStyles,handleChange=_ref.handleChange,inputContainerStyles=_ref.inputContainerStyles,inputStyles=_ref.inputStyles,isRTL=_ref.isRTL,keyboardType=_ref.keyboardType,numberOfInputs=_ref.numberOfInputs,placeholder=_ref.placeholder,secureTextEntry=_ref.secureTextEntry,selectTextOnFocus=_ref.selectTextOnFocus,style=_ref.style,_ref$testIDPrefix=_ref.testIDPrefix,testIDPrefix=_ref$testIDPrefix===void 0?'otpInput':_ref$testIDPrefix,restProps=_objectWithoutProperties(_ref,["autoCapitalize","clearTextOnFocus","defaultValue","focusStyles","handleChange","inputContainerStyles","inputStyles","isRTL","keyboardType","numberOfInputs","placeholder","secureTextEntry","selectTextOnFocus","style","testIDPrefix"]);var _useReducer=useReducer(reducer,{},function(){return{otpCode:fillOtpCode(numberOfInputs,defaultValue),handleChange:handleChange};}),_useReducer2=_slicedToArray(_useReducer,2),otpCode=_useReducer2[0].otpCode,dispatch=_useReducer2[1];var previousCopiedText=useRef('');var inputs=useRef([]);useEffect(function(){if(Platform.OS==='android'){KeyEvent.onKeyUpListener(handleOnKeyUp);}return function(){if(Platform.OS==='android'){KeyEvent.removeKeyUpListener();}};},[]);useImperativeHandle(ref,function(){return{reset:function reset(){dispatch({type:ACTION_TYPES.clearOtp,payload:numberOfInputs});inputs.current.forEach(function(input){return input&&input.current&&input.current.clear();});previousCopiedText.current='';Clipboard.setString('');},focus:function focus(){var firstInput=inputs.current[0];firstInput&&firstInput.current&&firstInput.current.focus();}};},[numberOfInputs]);var handleOnKeyUp=function handleOnKeyUp(event){var index=inputs.current.findIndex(function(input){return input.current&&input.current.isFocused();});var text=event.keyCode===BACKSPACE_KEY_CODE?'':event.pressedKey;handleTextChange(text,index);};var handleInputTextChange=function handleInputTextChange(_ref2){var text=_ref2.text,index=_ref2.index;dispatch({type:ACTION_TYPES.setOtpTextForIndex,payload:{text:text,index:index}});focusInput(index+1);};var handleTextChange=function handleTextChange(text,index){if(!text.length){handleClearInput(index);}if(text){handleInputTextChange({text:text,index:index});}if(index===numberOfInputs-1&&text){Keyboard.dismiss();}};var _handleKeyPress=function handleKeyPress(_ref3,index){var key=_ref3.nativeEvent.key;if(Platform.OS==='ios'&&key==='Backspace'){handleTextChange('',index);}};var focusInput=useCallback(function(index){if(index>=0&&index<numberOfInputs){var input=inputs.current[index];input&&input.current&&input.current.focus();}},[numberOfInputs]);var handleClearInput=useCallback(function(inputIndex){var input=inputs.current[inputIndex];input&&input.current&&input.current.clear();dispatch({type:ACTION_TYPES.setOtpTextForIndex,payload:{index:inputIndex,text:''}});focusInput(inputIndex-1);},[focusInput]);var fillInputs=useCallback(function(code){dispatch({type:ACTION_TYPES.setOtpCode,payload:{numberOfInputs:numberOfInputs,code:code}});},[numberOfInputs]);var listenOnCopiedText=useCallback(function _callee(){var copiedText,otpCodeValue;return _regeneratorRuntime.async(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return _regeneratorRuntime.awrap(Clipboard.getString());case 2:copiedText=_context.sent;otpCodeValue=Object.values(otpCode).join('');if(copiedText&&copiedText.length===numberOfInputs&&copiedText!==otpCodeValue&&copiedText!==previousCopiedText.current){previousCopiedText.current=copiedText;fillInputs(copiedText);}case 5:case"end":return _context.stop();}}});},[fillInputs,numberOfInputs,otpCode]);useEffect(function(){var interval=setInterval(function(){listenOnCopiedText();},500);return function(){clearInterval(interval);};},[listenOnCopiedText,numberOfInputs]);var renderInputs=function renderInputs(){var iterationArray=Array(numberOfInputs).fill(0);return iterationArray.map(function(_,index){var inputIndex=index;if(isRTL){inputIndex=numberOfInputs-1-index;}var inputValue=otpCode[""+inputIndex];if(!inputs.current[inputIndex]){inputs.current[inputIndex]=React.createRef();}return React.createElement(OtpInput,_extends({handleKeyPress:function handleKeyPress(keyPressEvent){return _handleKeyPress(keyPressEvent,inputIndex);},autoCapitalize:autoCapitalize,clearTextOnFocus:clearTextOnFocus,firstInput:index===0,focusStyles:focusStyles,handleTextChange:Platform.OS==='ios'?function(text){return handleTextChange(text,inputIndex);}:function(){},inputContainerStyles:inputContainerStyles,inputStyles:inputStyles,key:inputIndex,keyboardType:keyboardType,numberOfInputs:numberOfInputs,placeholder:placeholder,ref:inputs.current[inputIndex],secureTextEntry:secureTextEntry,selectTextOnFocus:selectTextOnFocus,testID:testIDPrefix+"-"+inputIndex,inputValue:inputValue},restProps,{__source:{fileName:_jsxFileName,lineNumber:257}}));});};return React.createElement(View,{style:style,__source:{fileName:_jsxFileName,lineNumber:287}},renderInputs());});export{OtpInputsRef};export default OtpInputs;OtpInputs.defaultProps={autoCapitalize:'none',clearTextOnFocus:false,handleChange:console.log,keyboardType:'phone-pad',numberOfInputs:4,secureTextEntry:false,selectTextOnFocus:true,testIDPrefix:'otpInput',isRTL:false,placeholder:'',style:{flex:1,flexDirection:'row',alignItems:'center',justifyContent:'space-between'},focusStyles:{borderColor:'#00f'},inputStyles:{fontSize:24,paddingTop:10,textAlign:'center',width:40},inputContainerStyles:{borderBottomWidth:1,height:53,margin:10}};
//# sourceMappingURL=index.js.map